# 5. ë¡œì§ ê³µìœ 

## IOSì™€ ì•ˆë“œë¡œì´ë“œ ê°„ ë¡œì§ ê³µìœ 

ì´ì œ ì™¸ë¶€ ì¢…ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ê³µí†µ ë…¼ë¦¬ë¥¼ êµ¬í˜„í–ˆìœ¼ë¯€ë¡œ ë” ë³µì¡í•œ ë…¼ë¦¬ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë° ë°ì´í„° ì§ë ¬í™”ëŠ” Kotlin Multiplatformì„ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ê³µìœ í•˜ëŠ” [ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì‚¬ìš© ì‚¬ë¡€](https://kotlinlang.org/lp/multiplatform/) ì…ë‹ˆë‹¤ . ì´ ì˜¨ë³´ë”© ì—¬ì •ì„ ì™„ë£Œí•œ í›„ í–¥í›„ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì²« ë²ˆì§¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.

[ì—…ë°ì´íŠ¸ëœ ì•±ì€ SpaceX API](https://github.com/r-spacex/SpaceX-API/tree/master/docs#rspacex-api-docs) ì—ì„œ ì¸í„°ë„·ì„ í†µí•´ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê³  SpaceX ë¡œì¼“ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ë°œì‚¬ëœ ë‚ ì§œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

### ë” ë§ì€ ì¢…ì†ì„± ì¶”ê°€ï»¿ <a href="#add-more-dependencies" id="add-more-dependencies"></a>

í”„ë¡œì íŠ¸ì— ë‹¤ìŒ ë‹¤ì¤‘ í”Œë«í¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

* [`kotlinx.coroutines`](https://github.com/Kotlin/kotlinx.coroutines), ë™ì‹œ ì‘ì—…ì„ í—ˆìš©í•˜ëŠ” ë¹„ë™ê¸° ì½”ë“œì— ì½”ë£¨í‹´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
* [`kotlinx.serialization`](https://github.com/Kotlin/kotlinx.serialization), ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì—”í„°í‹° í´ë˜ìŠ¤ì˜ ê°œì²´ë¡œ JSON ì‘ë‹µì„ ì—­ì§ë ¬í™”í•©ë‹ˆë‹¤.
* [KtorëŠ”](https://ktor.io/) ì¸í„°ë„·ì„ í†µí•´ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ë§Œë“œëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

#### kotlinx.coroutinesï»¿ <a href="#kotlinx-coroutines" id="kotlinx-coroutines"></a>

`kotlinx.coroutines`í”„ë¡œì íŠ¸ì— ì¶”ê°€í•˜ë ¤ë©´ ê³µí†µ ì†ŒìŠ¤ ì„¸íŠ¸ì— ì¢…ì†ì„±ì„ ì§€ì •í•˜ì„¸ìš”. ì´ë ‡ê²Œ í•˜ë ¤ë©´ `build.gradle.kts`ê³µìœ  ëª¨ë“ˆì˜ íŒŒì¼ì— ë‹¤ìŒ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”.

```
kotlin {
    // ...
    sourceSets {
        commonMain.dependencies {
           // ...
           implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3")
        }
    }
}
```

Multiplatform Gradle í”ŒëŸ¬ê·¸ì¸ì€ ìë™ìœ¼ë¡œ .ì˜ í”Œë«í¼ë³„(iOS ë° Android) ë¶€ë¶„ì— ì¢…ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤ `kotlinx.coroutines`.

#### kotlinx.ì§ë ¬í™”ï»¿ <a href="#kotlinx-serialization" id="kotlinx-serialization"></a>

ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `kotlinx.serialization`í•´ë‹¹ Gradle í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì •í•˜ì„¸ìš”. ê·¸ë ‡ê²Œ í•˜ë ¤ë©´ ê³µìœ  ëª¨ë“ˆì˜ íŒŒì¼ `plugins {}`ë§¨ ì²˜ìŒì— ìˆëŠ” ê¸°ì¡´ ë¸”ë¡ ì— ë‹¤ìŒ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”.`build.gradle.kts`

```
plugins {
    // ...
    kotlin("plugin.serialization") version "2.0.0"
}
```

#### ì–´ëŠï»¿ <a href="#ktor" id="ktor"></a>

`ktor-client-core`ê³µìœ  ëª¨ë“ˆì˜ ê³µí†µ ì†ŒìŠ¤ ì„¸íŠ¸ì— í•µì‹¬ ì¢…ì†ì„±( )ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤ . ë˜í•œ ì§€ì› ì¢…ì†ì„±ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

* ì½˜í…ì¸ ë¥¼ íŠ¹ì • í˜•ì‹ìœ¼ë¡œ ì§ë ¬í™” ë° ì—­ì§ë ¬í™”í•  ìˆ˜ ìˆëŠ” `ContentNegotiation`ê¸°ëŠ¥( )ì„ ì¶”ê°€í•©ë‹ˆë‹¤ .`ktor-client-content-negotiation`
* `ktor-serialization-kotlinx-json`Ktorê°€ JSON í˜•ì‹ì„ `kotlinx.serialization`ì§ë ¬í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì‚¬ìš©í•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” ì¢…ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤ . KtorëŠ” JSON ë°ì´í„°ë¥¼ ì˜ˆìƒí•˜ê³  ì‘ë‹µì„ ë°›ì„ ë•Œ ì´ë¥¼ ë°ì´í„° í´ë˜ìŠ¤ë¡œ ì—­ì§ë ¬í™”í•©ë‹ˆë‹¤.
* í”Œë«í¼ ì†ŒìŠ¤ ì„¸íŠ¸( `ktor-client-android`, `ktor-client-darwin`)ì˜ í•´ë‹¹ ì•„í‹°íŒ©íŠ¸ì— ëŒ€í•œ ì¢…ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ í”Œë«í¼ ì—”ì§„ì„ ì œê³µí•©ë‹ˆë‹¤.

```
kotlin {
    // ...
    val ktorVersion = "2.3.7"

    sourceSets {
        commonMain.dependencies {
            // ...

            implementation("io.ktor:ktor-client-core:$ktorVersion")
            implementation("io.ktor:ktor-client-content-negotiation:$ktorVersion")
            implementation("io.ktor:ktor-serialization-kotlinx-json:$ktorVersion")
        }
        androidMain.dependencies {
            implementation("io.ktor:ktor-client-android:$ktorVersion")
        }
        iosMain.dependencies {
            implementation("io.ktor:ktor-client-darwin:$ktorVersion")
        }
    }
}
```

ì•Œë¦¼ì—ì„œ ì§€ê¸ˆ ë™ê¸°í™”ë¥¼ í´ë¦­í•˜ì—¬ Gradle íŒŒì¼ì„ ë™ê¸°í™”í•©ë‹ˆë‹¤ .

### API ìš”ì²­ ìƒì„±ï»¿ <a href="#create-api-requests" id="create-api-requests"></a>

[ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ SpaceX APIê°€](https://github.com/r-spacex/SpaceX-API/tree/master/docs#rspacex-api-docs) í•„ìš”í•˜ë©° ë‹¨ì¼ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ v4/launches ì—”ë“œí¬ì¸íŠ¸ ì—ì„œ ëª¨ë“  ì‹¤í–‰ ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤ .

#### ë°ì´í„° ëª¨ë¸ ì¶”ê°€ï»¿ <a href="#add-a-data-model" id="add-a-data-model"></a>

ì—ì„œ `shared/src/commonMain/kotlin`ìƒˆ `RocketLaunch.kt`íŒŒì¼ì„ ë§Œë“¤ê³  SpaceX APIì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„° í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```
import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

@Serializable
data class RocketLaunch (
    @SerialName("flight_number")
    val flightNumber: Int,
    @SerialName("name")
    val missionName: String,
    @SerialName("date_utc")
    val launchDateUTC: String,
    @SerialName("success")
    val launchSuccess: Boolean?,
)
```

* í´ë˜ìŠ¤ ëŠ” ì£¼ì„ `RocketLaunch`ìœ¼ë¡œ í‘œì‹œë˜ì–´ í”ŒëŸ¬ê·¸ì¸ì´ ìë™ìœ¼ë¡œ í•´ë‹¹ í´ë˜ìŠ¤ì— ëŒ€í•œ ê¸°ë³¸ ì§ë ¬ ë³€í™˜ê¸°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`@Serializablekotlinx.serialization`
* ì£¼ì„ `@SerialName`ì„ ì‚¬ìš©í•˜ë©´ í•„ë“œ ì´ë¦„ì„ ì¬ì •ì˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë” ì½ê¸° ì‰¬ìš´ ì´ë¦„ìœ¼ë¡œ ë°ì´í„° í´ë˜ìŠ¤ì˜ ì†ì„±ì„ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### HTTP í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ï»¿ <a href="#connect-http-client" id="connect-http-client"></a>

1. ì—ì„œ `shared/src/commonMain/kotlin`ìƒˆ `RocketComponent`í´ë˜ìŠ¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.
2.  `httpClient`HTTP GET ìš”ì²­ì„ í†µí•´ ë¡œì¼“ ë°œì‚¬ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤ .

    ```
    import io.ktor.client.*
    import io.ktor.client.plugins.contentnegotiation.*
    import io.ktor.serialization.kotlinx.json.*
    import kotlinx.serialization.json.Json

    class RocketComponent {
        private val httpClient = HttpClient {
            install(ContentNegotiation) {
                json(Json {
                    prettyPrint = true
                    isLenient = true
                    ignoreUnknownKeys = true
                })
            }
        }
    }
    ```

    * ContentNegotiation [Ktor í”ŒëŸ¬ê·¸ì¸](https://ktor.io/docs/serialization-client.html#register\_json) ê³¼ JSON ì§ë ¬ ë³€í™˜ê¸°ëŠ” GET ìš”ì²­ì˜ ê²°ê³¼ë¥¼ ì—­ì§ë ¬í™”í•©ë‹ˆë‹¤.
    * ì—¬ê¸°ì„œ JSON ì§ë ¬ ë³€í™˜ê¸°ëŠ” ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ JSONì„ ë” ì½ê¸° ì‰¬ìš´ ë°©ì‹ìœ¼ë¡œ ì¸ì‡„í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤ `prettyPrint`. ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ëª»ëœ í˜•ì‹ì˜ JSONì„ ì½ì„ ë•Œ ë” ìœ ì—°í•˜ë©° ë¥¼ ì‚¬ìš© `isLenient`í•˜ì—¬ ë¡œì¼“ ë°œì‚¬ ëª¨ë¸ì—ì„œ ì„ ì–¸ë˜ì§€ ì•Šì€ í‚¤ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤ `ignoreUnknownKeys`.
3.  `getDateOfLastSuccessfulLaunch()`ì¼ì‹œ ì¤‘ì§€ ê¸°ëŠ¥ì„ ë‹¤ìŒì— ì¶”ê°€í•˜ì‹­ì‹œì˜¤ `RocketComponent`.

    ```
    private suspend fun getDateOfLastSuccessfulLaunch(): String {
        // ...
    }
    ```
4.  `httpClient.get()`ë¡œì¼“ ë°œì‚¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤ .

    ```
    import io.ktor.client.request.*
    import io.ktor.client.call.*

    private suspend fun getDateOfLastSuccessfulLaunch(): String {
        val rockets: List<RocketLaunch> = httpClient.get("https://api.spacexdata.com/v4/launches").body()
    }
    ```

    * `httpClient.get()`ìŠ¤ë ˆë“œë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šê³  ë¹„ë™ê¸°ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì¼ì‹œ ì¤‘ì§€ ê¸°ëŠ¥ì´ê¸°ë„ í•©ë‹ˆë‹¤.
    * ì •ì§€ í•¨ìˆ˜ëŠ” ì½”ë£¨í‹´ì´ë‚˜ ê¸°íƒ€ ì •ì§€ í•¨ìˆ˜ì—ì„œë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ í‚¤ì›Œë“œ `getDateOfLastSuccessfulLaunch()`ë¡œ í‘œì‹œë˜ëŠ” ì´ìœ ì…ë‹ˆë‹¤ `suspend`. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ HTTP í´ë¼ì´ì–¸íŠ¸ì˜ ìŠ¤ë ˆë“œ í’€ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
5.  ëª©ë¡ì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì„±ê³µí•œ ì‹¤í–‰ì„ ì°¾ìœ¼ë ¤ë©´ í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.

    ```
    private suspend fun getDateOfLastSuccessfulLaunch(): String {
        val rockets: List<RocketLaunch> = httpClient.get("https://api.spacexdata.com/v4/launches").body()
        val lastSuccessLaunch = rockets.last { it.launchSuccess == true }
    }
    ```

    ë¡œì¼“ ë°œì‚¬ ëª©ë¡ì€ ê°€ì¥ ì˜¤ë˜ëœ ê²ƒë¶€í„° ìµœì‹  ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤.
6.  ì‹œì‘ ë‚ ì§œë¥¼ UTCì—ì„œ í˜„ì§€ ë‚ ì§œë¡œ ë³€í™˜í•˜ê³  ì¶œë ¥ í˜•ì‹ì„ ì§€ì •í•©ë‹ˆë‹¤.

    ```
    import kotlinx.datetime.Instant
    import kotlinx.datetime.TimeZone
    import kotlinx.datetime.toLocalDateTime

    private suspend fun getDateOfLastSuccessfulLaunch(): String {
        val rockets: List<RocketLaunch> =
            httpClient.get("https://api.spacexdata.com/v4/launches").body()
        val lastSuccessLaunch = rockets.last { it.launchSuccess == true }
        val date = Instant.parse(lastSuccessLaunch.launchDateUTC)
            .toLocalDateTime(TimeZone.currentSystemDefault())

        return "${date.month} ${date.dayOfMonth}, ${date.year}"
    }
    ```

    ë‚ ì§œëŠ” 'MMMM DD, YYYY' í˜•ì‹ì…ë‹ˆë‹¤(ì˜ˆ: 2022ë…„ 10ì›” 5ì¼).
7.  `launchPhrase()`í•¨ìˆ˜ ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ëŠ” ë˜ ë‹¤ë¥¸ ì¼ì‹œ ì¤‘ì§€ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤ `getDateOfLastSuccessfulLaunch()`.

    ```
    suspend fun launchPhrase(): String =
        try {
            "The last successful launch was on ${getDateOfLastSuccessfulLaunch()} ğŸš€"
        } catch (e: Exception) {
            println("Exception during getting the date of the last successful launch $e")
            "Error occurred"
        }
    ```

#### íë¦„ ë§Œë“¤ê¸°ï»¿ <a href="#create-the-flow" id="create-the-flow"></a>

ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ ëŒ€ì‹  íë¦„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ë‹¨ì¼ ê°’ ëŒ€ì‹  ê°’ ì‹œí€€ìŠ¤ë¥¼ ë°©ì¶œí•©ë‹ˆë‹¤.

1. `Greeting.kt`ë””ë ‰í„°ë¦¬ ì—ì„œ íŒŒì¼ì„ ì—½ë‹ˆë‹¤ `shared/src/commonMain/kotlin`.
2.  `rocketComponent`í´ë˜ìŠ¤ ì— ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤ `Greeting`. ì†ì„±ì€ ë§ˆì§€ë§‰ ì„±ê³µì ì¸ ì‹œì‘ ë‚ ì§œì™€ í•¨ê»˜ ë©”ì‹œì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

    ```
    private val rocketComponent = RocketComponent()
    ```
3.  `greet()`ë‹¤ìŒì„ ë°˜í™˜í•˜ë„ë¡ í•¨ìˆ˜ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤ `Flow`.

    ```
    import kotlinx.coroutines.delay
    import kotlinx.coroutines.flow.Flow
    import kotlinx.coroutines.flow.flow
    import kotlin.time.Duration.Companion.seconds

    fun greet(): Flow<String> = flow {
         emit(if (Random.nextBoolean()) "Hi!" else "Hello!")
         delay(1.seconds)
         emit("Guess what this is! > ${platform.name.reversed()}")
         delay(1.seconds)
         emit(daysPhrase())
         emit(rocketComponent.launchPhrase())
    }
    ```

    * `Flow`ì—¬ê¸°ì„œëŠ” `flow()`ëª¨ë“  ëª…ë ¹ë¬¸ì„ ë˜í•‘í•˜ëŠ” ë¹Œë” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„± ë©ë‹ˆë‹¤.
    * `Flow`ê° ë°©ì¶œ ì‚¬ì´ì— 1ì´ˆì˜ ì§€ì—°ì„ ë‘ê³  ë¬¸ìì—´ì„ ë°©ì¶œí•©ë‹ˆë‹¤ . ë§ˆì§€ë§‰ ìš”ì†ŒëŠ” ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ë°˜í™˜ëœ í›„ì—ë§Œ ë°©ì¶œë˜ë¯€ë¡œ ì •í™•í•œ ì§€ì—°ì€ ë„¤íŠ¸ì›Œí¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.

#### ì¸í„°ë„· ì•¡ì„¸ìŠ¤ ê¶Œí•œ ì¶”ê°€ï»¿ <a href="#add-internet-access-permission" id="add-internet-access-permission"></a>

ì¸í„°ë„·ì— ì ‘ì†í•˜ë ¤ë©´ Android ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ì ˆí•œ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ ê³µìœ  ëª¨ë“ˆì—ì„œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ì¸í„°ë„· ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì¶”ê°€í•˜ëŠ” ê²ƒì´ í•©ë¦¬ì ì…ë‹ˆë‹¤.

`composeApp/src/androidMain/AndroidManifest.xml`ì•¡ì„¸ìŠ¤ ê¶Œí•œìœ¼ë¡œ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤ .

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET"/>
    ...
</manifest>
```

### ê¸°ë³¸ Android ë° iOS UI ì—…ë°ì´íŠ¸ï»¿ <a href="#update-native-android-and-ios-ui" id="update-native-android-and-ios-ui"></a>

`greet()`í•¨ìˆ˜ ì˜ ë°˜í™˜ ìœ í˜•ì„ ë¡œ ë³€ê²½í•˜ì—¬ ê³µìœ  ëª¨ë“ˆì˜ APIë¥¼ ì´ë¯¸ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤ `Flow`. ì´ì œ í•¨ìˆ˜ í˜¸ì¶œ ê²°ê³¼ë¥¼ ì ì ˆí•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸(iOS, Android) ë¶€ë¶„ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤ `greet()`.

#### ì•ˆë“œë¡œì´ë“œ ì•±ï»¿ <a href="#android-app" id="android-app"></a>

ê³µìœ  ëª¨ë“ˆê³¼ Android ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‘ Kotlinìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë¯€ë¡œ Androidì˜ ê³µìœ  ì½”ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•©ë‹ˆë‹¤.

**ë·° ëª¨ë¸ ì†Œê°œ**ï»¿

ì´ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë”ìš± ë³µì¡í•´ì§€ê³  ìˆìœ¼ë¯€ë¡œ ì´ë¼ëŠ” [Android í™œë™](https://developer.android.com/guide/components/activities/intro-activities)`MainActivity` ì— ë·° ëª¨ë¸ì„ ë„ì…í•  ì°¨ë¡€ì…ë‹ˆë‹¤ . `App()`UIë¥¼ êµ¬í˜„í•˜ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤ . ë·° ëª¨ë¸ì€ í™œë™ì˜ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ë©° í™œë™ì˜ ìˆ˜ëª… ì£¼ê¸°ê°€ ë³€ê²½ë  ë•Œ ì‚¬ë¼ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.

1.  íŒŒì¼ ì— ë‹¤ìŒ ì¢…ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤ `composeApp/build.gradle.kts`.

    ```
    androidMain.dependencies {
        // ...
        implementation("androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.2")
        implementation("androidx.lifecycle:lifecycle-runtime-compose:2.6.2")
        implementation("androidx.lifecycle:lifecycle-viewmodel-compose:2.6.2")
    }
    ```
2.  ì—ì„œ `composeApp/src/androidMain/kotlin`ìƒˆ `MainViewModel`Kotlin í´ë˜ìŠ¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.

    ```
    import androidx.lifecycle.ViewModel

    class MainViewModel : ViewModel() {
        // ...
    }
    ```

    ì´ í´ë˜ìŠ¤ëŠ” Android `ViewModel`í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ ìˆ˜ëª… ì£¼ê¸° ë° êµ¬ì„± ë³€ê²½ê³¼ ê´€ë ¨ëœ ì˜¬ë°”ë¥¸ ë™ì‘ì„ ë³´ì¥í•©ë‹ˆë‹¤.
3.  [StateFlow](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-state-flow/)`greetingList` ìœ í˜• ì˜ ê°’ ê³¼ í•´ë‹¹ ì§€ì› ì†ì„±ì„ ë§Œë“­ë‹ˆë‹¤ .

    ```
    import kotlinx.coroutines.flow.MutableStateFlow
    import kotlinx.coroutines.flow.StateFlow

    class MainViewModel : ViewModel() {
        private val _greetingList = MutableStateFlow<List<String>>(listOf())
        val greetingList: StateFlow<List<String>> get() = _greetingList
    }
    ```

    * `StateFlow`ì—¬ê¸°ì„œëŠ” `Flow`ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•˜ì§€ë§Œ ë‹¨ì¼ ê°’ì´ë‚˜ ìƒíƒœë¥¼ ê°–ìŠµë‹ˆë‹¤.
    * ê°œì¸ ë°±ì—… ì†ì„±ì€ `_greetingList`ì´ í´ë˜ìŠ¤ì˜ í´ë¼ì´ì–¸íŠ¸ë§Œ ì½ê¸° ì „ìš© `greetingList`ì†ì„±ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.
4.  `init`ë·° ëª¨ë¸ì˜ ê¸°ëŠ¥ ì—ì„œ `Greeting().greet()`íë¦„ì˜ ëª¨ë“  ë¬¸ìì—´ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

    ```
    import androidx.lifecycle.viewModelScope
    import kotlinx.coroutines.launch

    class MainViewModel : ViewModel() {
       private val _greetingList = MutableStateFlow<List<String>>(listOf())
       val greetingList: StateFlow<List<String>> get() = _greetingList

       init {
           viewModelScope.launch {
               Greeting().greet().collect { phrase ->
                    //...
               }
           }
       }
    }
    ```

    í•¨ìˆ˜ê°€ `collect()`ì¼ì‹œ ì¤‘ë‹¨ë˜ì—ˆìœ¼ë¯€ë¡œ `launch`ì½”ë£¨í‹´ì€ ë·° ëª¨ë¸ ë²”ìœ„ ë‚´ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ëŠ” ì‹¤í–‰ ì½”ë£¨í‹´ì´ ë·° ëª¨ë¸ ìˆ˜ëª… ì£¼ê¸°ì˜ ì˜¬ë°”ë¥¸ ë‹¨ê³„ì—ì„œë§Œ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
5.  í›„í–‰ ëŒë‹¤ ë‚´ì—ì„œ ë‹¤ìŒì˜ êµ¬ë¬¸ ëª©ë¡ì— ìˆ˜ì§‘ëœ ê°’ì„ ì¶”ê°€í•˜ë„ë¡ `collect`ê°’ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤ .`_greetingListphraselist`

    ```
    import kotlinx.coroutines.flow.update

    class MainViewModel : ViewModel() {
        //...

        init {
            viewModelScope.launch {
                Greeting().greet().collect { phrase ->
                    _greetingList.update { list -> list + phrase }
                }
            }
        }
    }
    ```

    ì´ `update()`í•¨ìˆ˜ëŠ” ê°’ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

**ë·° ëª¨ë¸ì˜ íë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”**ï»¿

1.  ì—ì„œ íŒŒì¼ `composeApp/src/androidMain/kotlin`ì„ ì°¾ì•„ `App.kt`ì—…ë°ì´íŠ¸í•˜ì—¬ ì´ì „ êµ¬í˜„ì„ ëŒ€ì²´í•©ë‹ˆë‹¤.

    ```
    import androidx.lifecycle.compose.collectAsStateWithLifecycle
    import androidx.compose.runtime.getValue
    import androidx.lifecycle.viewmodel.compose.viewModel

    @Composable
    fun App(mainViewModel: MainViewModel = viewModel()) {
        MaterialTheme {
            val greetings by mainViewModel.greetingList.collectAsStateWithLifecycle()

            Column(
                modifier = Modifier.padding(all = 20.dp),
                verticalArrangement = Arrangement.spacedBy(8.dp),
            ) {
                greetings.forEach { greeting ->
                    Text(greeting)
                    Divider()
                }
            }
        }
    }
    ```

    * ì´ í•¨ìˆ˜ëŠ” ë·° ëª¨ë¸ì˜ íë¦„ì—ì„œ ê°’ì„ ìˆ˜ì§‘í•˜ê³  ì´ë¥¼ ìˆ˜ëª… ì£¼ê¸° ì¸ì‹ ë°©ì‹ìœ¼ë¡œ êµ¬ì„± ê°€ëŠ¥í•œ ìƒíƒœë¡œ í‘œì‹œí•˜ë„ë¡ `collectAsStateWithLifecycle()`í˜¸ì¶œí•©ë‹ˆë‹¤ .`greetingList`
    * ìƒˆ íë¦„ì´ ìƒì„±ë˜ë©´ ì‘ì„± ìƒíƒœê°€ ë³€ê²½ë˜ê³  `Column`ì„¸ë¡œë¡œ ë°°ì—´ë˜ê³  êµ¬ë¶„ì„ ìœ¼ë¡œ êµ¬ë¶„ëœ ì¸ì‚¬ë§ ë¬¸êµ¬ê°€ í¬í•¨ëœ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ í•­ëª©ì´ í‘œì‹œë©ë‹ˆë‹¤.
2.  ê²°ê³¼ë¥¼ ë³´ë ¤ë©´ Android Studioì—ì„œ composeApp êµ¬ì„±ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.

    <figure><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/stable/multiplatform-mobile-upgrade-android.png" alt="ìµœì¢… ê²°ê³¼" height="626" width="300"><figcaption></figcaption></figure>

#### iOS ì•±ï»¿ <a href="#ios-app" id="ios-app"></a>

í”„ë¡œì íŠ¸ì˜ iOS ë¶€ë¶„ì—ì„œëŠ” [Model-view-viewmodel](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel) íŒ¨í„´ì„ ë‹¤ì‹œ ì‚¬ìš©í•˜ì—¬ UIë¥¼ ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í¬í•¨ëœ ê³µìœ  ëª¨ë“ˆì— ì—°ê²°í•©ë‹ˆë‹¤.

ëª¨ë“ˆì€ ì´ë¯¸ ì„ ì–¸ `ContentView.swift`ê³¼ í•¨ê»˜ íŒŒì¼ ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤ `import Shared`.

> ####
>
> ê³µìœ  ëª¨ë“ˆê³¼ ê´€ë ¨í•˜ì—¬ Xcodeì—ì„œ ì˜¤ë¥˜ê°€ í‘œì‹œë˜ê±°ë‚˜ ì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ Android Studioì—ì„œ iosApp êµ¬ì„±ì„ ì‹¤í–‰í•˜ì„¸ìš”.

**ë·° ëª¨ë¸ ì†Œê°œ**ï»¿

1. Xcodeì—ì„œ iOS ì•±ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
2.  ì—ì„œ `iosApp/iOSApp.swift`ì•±ì˜ ì§„ì…ì ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

    ```
    @main
    struct iOSApp: App {
        var body: some Scene {
            WindowGroup {
                ContentView(viewModel: ContentView.ViewModel())
            }
        }
    }
    ```
3.  ì—ì„œ ë°ì´í„°ë¥¼ ì¤€ë¹„í•˜ê³  ê´€ë¦¬í•  í´ë˜ìŠ¤ë¥¼ `iosApp/ContentView.swift`ë§Œë“­ë‹ˆë‹¤ . ë™ì‹œì„±ì„ ì§€ì›í•˜ë ¤ë©´ í˜¸ì¶œ ë‚´ì—ì„œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì„¸ìš” .`ViewModelContentViewstartObserving()task()`

    ```
    import SwiftUI
    import Shared

    struct ContentView: View {
        @ObservedObject private(set) var viewModel: ViewModel

        var body: some View {
            ListView(phrases: viewModel.greetings)
                .task { await self.viewModel.startObserving() }
        }
    }

    extension ContentView {
        @MainActor
        class ViewModel: ObservableObject {
            @Published var greetings: Array<String> = []

            func startObserving() {
                // ...
            }
        }
    }

    struct ListView: View {
        let phrases: Array<String>

        var body: some View {
            List(phrases, id: \.self) {
                Text($0)
            }
        }
    }
    ```

    * `ViewModelContentView`ì€ ë°€ì ‘í•˜ê²Œ ì—°ê²°ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì˜ í™•ì¥ìœ¼ë¡œ ì„ ì–¸ë©ë‹ˆë‹¤ .
    * `ViewModelgreetings`êµ¬ë¬¸ ë°°ì—´ì¸ ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤ `String`. SwiftUIëŠ” ë·° ëª¨ë¸( `ContentView.ViewModel`)ì„ ë·°( `ContentView`)ì™€ ì—°ê²°í•©ë‹ˆë‹¤.
    * `ContentView.ViewModel`ìœ¼ë¡œ ì„ ì–¸ë©ë‹ˆë‹¤ `ObservableObject`.
    * ë˜í¼ ëŠ” ì†ì„± `@Published`ì— ì‚¬ìš©ë©ë‹ˆë‹¤ `greetings`.
    * ì†ì„± `@ObservedObject`ë˜í¼ëŠ” ë·° ëª¨ë¸ì„ êµ¬ë…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

ì´ì œ ë·° ëª¨ë¸ì€ ì´ ì†ì„±ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹ í˜¸ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤.

**iOSì˜ íë¦„ì„ ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ**ï»¿

[ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” SKIE](https://github.com/touchlab/SKIE/) ë° [KMP-NativeCoroutines](https://github.com/rickclephas/KMP-NativeCoroutines) ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ì—ì„œ ì„ íƒí•˜ì—¬ iOSì—ì„œ íë¦„ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‘˜ ë‹¤ Kotlin/Native ì»´íŒŒì¼ëŸ¬ê°€ ì•„ì§ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•ŠëŠ” ì·¨ì†Œ ë° íë¦„ì˜ ì œë„¤ë¦­ì„ ì§€ì›í•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.

SKIE ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Kotlin ì»´íŒŒì¼ëŸ¬ì—ì„œ ìƒì„±ëœ Objective-C APIë¥¼ ê°•í™”í•©ë‹ˆë‹¤. SKIEëŠ” íë¦„ì„ Swiftì˜ `AsyncSequence`. SKIEëŠ” ìŠ¤ë ˆë“œ ì œí•œ ì—†ì´ ìë™ ì–‘ë°©í–¥ ì·¨ì†Œ ê¸°ëŠ¥ì„ í†µí•´ Swiftì˜ `async`/ ë¥¼ ì§ì ‘ ì§€ì›í•©ë‹ˆë‹¤(Combine ë° RxSwiftì—ëŠ” ì–´ëŒ‘í„° í•„ìš”). `await`SKIEëŠ” ë‹¤ì–‘í•œ Kotlin ìœ í˜•ì„ Swiftì— ìƒì‘í•˜ëŠ” ìœ í˜•ìœ¼ë¡œ ì—°ê²°í•˜ëŠ” ê²ƒì„ í¬í•¨í•˜ì—¬ Kotlinì—ì„œ Swift ì¹œí™”ì ì¸ APIë¥¼ ìƒì„±í•˜ëŠ” ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ë˜í•œ iOS í”„ë¡œì íŠ¸ì— ì¶”ê°€ ì¢…ì†ì„±ì„ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

KMP-NativeCoroutines ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” í•„ìš”í•œ ë˜í¼ë¥¼ ìƒì„±í•˜ì—¬ iOSì—ì„œ ì¼ì‹œ ì¤‘ì§€ ê¸°ëŠ¥ê³¼ íë¦„ì„ ì‚¬ìš©í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. KMP-NativeCoroutineì€ Swiftì˜ `async`/ `await`ê¸°ëŠ¥ì€ ë¬¼ë¡  Combine ë° RxSwiftë„ ì§€ì›í•©ë‹ˆë‹¤. SKIEë³´ë‹¤ ì˜¤ë«ë™ì•ˆ ì‚¬ìš© ê°€ëŠ¥í–ˆê¸° ë•Œë¬¸ì— ì˜¤ëŠ˜ë‚ ì—ëŠ” ì˜ˆì™¸ì ì¸ ì‚¬ë¡€ê°€ ë” ì ê²Œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. KMP-NativeCoroutineì„ ì‚¬ìš©í•˜ë ¤ë©´ iOS í”„ë¡œì íŠ¸ì— Cocoapod ë˜ëŠ” SPM ì¢…ì†ì„±ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

\
